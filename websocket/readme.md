# websocket

### 背景

传统http方式存在瓶颈，被动且消耗资源，：

* 一条连接上只可以发送一个请求
* 请求只能从客户端开始。客户端不可以接收除了响应以外的指令。

* 请求 / 响应首部未经过压缩就直接进行传输。首部的信息越多，那么延迟就越大。
* 发送冗长的首部。每次互相发送相同的首部造成的浪费越多

* 可以任意选择数据压缩格式。非强制压缩发送

### 优势

websocket是http协议的补充，存在交集，websocket基于HTTP协议，在http建立连接后，还需要进行一次“握手”的步骤

具有以下特点：

* **推送功能**
  支持服务器端向客户端推送功能。服务器可以直接发送数据而不用等待客户端的请求。
* **减少通信量和资源消耗**
  只要建立起websocket连接，就一直保持连接，在此期间可以源源不断的传送消息，直到关闭请求。也就避免了HTTP的非状态性。
  和http相比，不但每次连接时的总开销减少了，而且websocket的首部信息量也小 ，通信量也减少了。

### 缺陷

* 服务器长期维护长连接需要一定的成本
* 各个浏览器支持程度不一
* websocket 是长连接，受网络限制比较大，需要处理好重连，比如用户进电梯或电信用户打个电话网断了，这时候就需要重连

### 应用场景

websocket在实时通信领域运用的比较多，比如社交聊天、弹幕、多玩家游戏、协同编辑、股票基金实时报价、体育实况更新、视频会议/聊天、基于位置的应用、在线教育、智能家居等需要高实时的场景

### demo说明

基于autobahn-python + asyncio

模拟服务端、客户端通信，客户端启动后建立连接，发送消息给服务端，服务端响应

运行方式：依次执行server.py client.py
